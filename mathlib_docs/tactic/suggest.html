<!DOCTYPE html><html lang="en"><head><title>tactic.suggest</title><meta charset="UTF-8"><link rel="stylesheet" href="https://robertylewis.com/mathlib_docs/style.css"></head><body><div class="mod_doc"><p><code>suggest</code> and <code>library_search</code> are a pair of tactics for applying lemmas from the library to the
current goal.</p>

<ul>
<li><code>suggest</code> prints a list of <code>exact ...</code> or <code>refine ...</code> statements, which may produce new goals</li>
<li><code>library_search</code> prints a single <code>exact ...</code> which closes the goal, or fails</li>
</ul>
</div><div class="def"><a id="tactic.suggest.head_symbol"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L26">tactic.suggest.head_symbol</a></span> <span class="decl_args">(a : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a></div>
<div class="indent"><p>compute the head symbol of an expression, but normalise <code>&gt;</code> to <code>&lt;</code> and <code>≥</code> to <code>≤</code></p>
       </div>
</div><div class="cnst"><a id="tactic.suggest.head_symbol_match"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L45">tactic.suggest.head_symbol_match</a></span>  <span class="decl_args">:</span>       <div class="decl_type">Type</div>
<div class="indent"><p>A declaration can match the head symbol of the current goal in four possible ways:
* <code>ex</code>  : an exact match
* <code>mp</code>  : the declaration returns an <code>iff</code>, and the right hand side matches the goal
* <code>mpr</code> : the declaration returns an <code>iff</code>, and the left hand side matches the goal
* <code>both</code>: the declaration returns an <code>iff</code>, and the both sides match the goal</p>
       </div>
</div><div class="def"><a id="tactic.suggest.head_symbol_match.to_string"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L51">tactic.suggest.head_symbol_match.to_string</a></span> <span class="decl_args">(a : <a href="https://robertylewis.com/mathlib_docs/tactic/suggest.html#tactic.suggest.head_symbol_match">tactic.suggest.head_symbol_match</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a></div>
<div class="indent"><p>a textual representation of a <code>head_symbol_match</code>, for trace debugging.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.unfold_head_symbol"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L63">tactic.suggest.unfold_head_symbol</a></span> <span class="decl_args">(a : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a></div>
<div class="indent"><p>When we are determining if a given declaration is potentially relevant for the current goal,
we compute <code>unfold_head_symbol</code> on the head symbol of the declaration, producing a list of names.
We consider the declaration potentially relevant if the head symbol of the goal appears in this list.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.match_head_symbol"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L68">tactic.suggest.match_head_symbol</a></span> <span class="decl_args">(hs : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">(a : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/core.html#option">option</a> <a href="https://robertylewis.com/mathlib_docs/tactic/suggest.html#tactic.suggest.head_symbol_match">tactic.suggest.head_symbol_match</a></div>
<div class="indent"><p>Determine if, and in which way, a given expression matches the specified head symbol.</p>
       </div>
</div><div class="cnst"><a id="tactic.suggest.decl_data"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L82">tactic.suggest.decl_data</a></span>  <span class="decl_args">:</span>       <div class="decl_type">Type</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="tactic.suggest.process_declaration"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L94">tactic.suggest.process_declaration</a></span> <span class="decl_args">(hs : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">(d : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/declaration.html#declaration">declaration</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/core.html#option">option</a> <a href="https://robertylewis.com/mathlib_docs/tactic/suggest.html#tactic.suggest.decl_data">tactic.suggest.decl_data</a></div>
<div class="indent"><p>Generate a <code>decl_data</code> from the given declaration if
it matches the head symbol <code>hs</code> for the current goal.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.library_defs"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L102">tactic.suggest.library_defs</a></span> <span class="decl_args">(hs : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/tactic/suggest.html#tactic.suggest.decl_data">tactic.suggest.decl_data</a>)</div>
<div class="indent"><p>Retrieve all library definitions with a given head symbol.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.apply_and_solve"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L114">tactic.suggest.apply_and_solve</a></span> <span class="decl_args">(close_goals : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a>)</span> <span class="decl_args">(discharger : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a>)</span> <span class="decl_args">(e : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></div>
<div class="indent"><p>Apply the lemma <code>e</code>, then attempt to close all goals using <code>solve_by_elim { discharger := discharger }</code>,
failing if <code>close_goals = tt</code> and there are any goals remaining.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.apply_declaration"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L136">tactic.suggest.apply_declaration</a></span> <span class="decl_args">(close_goals : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a>)</span> <span class="decl_args">(discharger : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a>)</span> <span class="decl_args">(d : <a href="https://robertylewis.com/mathlib_docs/tactic/suggest.html#tactic.suggest.decl_data">tactic.suggest.decl_data</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></div>
<div class="indent"><p>Apply the declaration <code>d</code> (or the forward and backward implications separately, if it is an <code>iff</code>),
and then attempt to solve the goal using <code>apply_and_solve</code>.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.replace_mvars"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L152">tactic.suggest.replace_mvars</a></span> <span class="decl_args">(e : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a></div>
<div class="indent"><p>Replace any metavariables in the expression with underscores, in preparation for printing
<code>refine ...</code> statements.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.tactic_statement"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L158">tactic.suggest.tactic_statement</a></span> <span class="decl_args">(g : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a></div>
<div class="indent"><p>Construct a <code>refine ...</code> or <code>exact ...</code> string which would construct <code>g</code>.</p>
       </div>
</div><div class="def"><a id="tactic.suggest.message"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L169">tactic.suggest.message</a></span> <span class="decl_args">(g : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a>)</span> <span class="decl_args">(l : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic_state">tactic_state</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a></div>
<div class="indent"><p>Assuming that a goal <code>g</code> has been (partially) solved in the tactic_state <code>l</code>,
this function prepares a string of the form <code>exact ...</code> or <code>refine ...</code> (possibly with underscores)
that will reproduce that result.</p>
       </div>
</div><div class="cnst"><a id="tactic.suggest.application"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L177">tactic.suggest.application</a></span>  <span class="decl_args">:</span>       <div class="decl_type">Type</div>
<div class="indent"><p>An <code>application</code> records the result of a successful application of a library lemma.</p>
       </div>
</div><div class="def"><a id="tactic.suggest_core"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L247">tactic.suggest_core</a></span> <span class="decl_args">(discharger : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a>) <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic.done">tactic.done</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/data/mllist.html#tactic.mllist">tactic.mllist</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/tactic/suggest.html#tactic.suggest.application">tactic.suggest.application</a></div>
<div class="indent"><p>The core <code>suggest</code> tactic.
It attempts to apply a declaration from the library,
then solve new goals using <code>solve_by_elim</code>.</p>

<p>It returns a list of <code>application</code>s consisting of fields:
* <code>state</code>, a tactic state resulting from the successful application of a declaration from the library,
* <code>script</code>, a string of the form <code>refine ...</code> or <code>exact ...</code> which will reproduce that tactic state,
* <code>decl</code>, an <code>option declaration</code> indicating the declaration that was applied (or none, if <code>solve_by_elim</code> succeeded),
* <code>num_goals</code>, the number of remaining goals, and
* <code>hyps_used</code>, the number of local hypotheses used in the solution.</p>
       </div>
</div><div class="def"><a id="tactic.suggest"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L256">tactic.suggest</a></span> <span class="decl_args">(limit : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#option">option</a> ℕ) option.none)</span> <span class="decl_args">(discharger : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a>) <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic.done">tactic.done</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/tactic/suggest.html#tactic.suggest.application">tactic.suggest.application</a>)</div>
<div class="indent"><p>See <code>suggest_core</code>.</p>

<p>Returns a list of at most <code>limit</code> <code>application</code>s,
sorted by number of goals, and then (reverse) number of hypotheses used.</p>
       </div>
</div><div class="def"><a id="tactic.suggest_scripts"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L267">tactic.suggest_scripts</a></span> <span class="decl_args">(limit : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#option">option</a> ℕ) option.none)</span> <span class="decl_args">(discharger : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a>) <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic.done">tactic.done</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a>)</div>
<div class="indent"><p>Returns a list of at most <code>limit</code> strings, of the form <code>exact ...</code> or <code>refine ...</code>, which make
progress on the current goal using a declaration from the library.</p>
       </div>
</div><div class="def"><a id="tactic.library_search"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L274">tactic.library_search</a></span> <span class="decl_args">(discharger : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a>) <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic.done">tactic.done</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a></div>
<div class="indent"><p>Returns a string of the form <code>exact ...</code>, which closes the current goal.</p>
       </div>
</div><div class="def"><a id="tactic.interactive.suggest"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L298">tactic.interactive.suggest</a></span> <span class="decl_args">(n : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/interactive_base.html#interactive.parse">interactive.parse</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/category/alternative.html#optional">optional</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/meta/interactive_base.html#interactive.with_desc">interactive.with_desc</a> ↑"n" <a href="https://robertylewis.com/mathlib_docs/core/init/meta/lean/parser.html#lean.parser.small_nat">lean.parser.small_nat</a>)))</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></div>
<div class="indent"><p><code>suggest</code> tries to apply suitable theorems/defs from the library, and generates
a list of <code>exact ...</code> or <code>refine ...</code> scripts that could be used at this step.
It leaves the tactic state unchanged. It is intended as a complement of the search
function in your editor, the <code>#find</code> tactic, and <code>library_search</code>.</p>

<p><code>suggest</code> takes an optional natural number <code>num</code> as input and returns the first <code>num</code>
(or less, if all possibilities are exhausted) possibilities ordered by length of lemma names.
The default for <code>num</code> is <code>50</code>.
For performance reasons <code>suggest</code> uses monadic lazy lists (<code>mllist</code>). This means that
<code>suggest</code> might miss some results if <code>num</code> is not large enough. However, because
<code>suggest</code> uses monadic lazy lists, smaller values of <code>num</code> run faster than larger values.</p>
       </div>
</div><div class="def"><a id="tactic.interactive.library_search"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L317">tactic.interactive.library_search</a></span>  <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></div>
<div class="indent"><p><code>library_search</code> attempts to apply every definition in the library whose head symbol
matches the goal, and then discharge any new goals using <code>solve_by_elim</code>.</p>

<p>If it succeeds, it prints a trace message <code>exact ...</code> which can replace the invocation
of <code>library_search</code>.</p>
       </div>
</div><div class="def"><a id="tactic.library_search_hole_cmd"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/tactic/suggest.lean#L326">tactic.library_search_hole_cmd</a></span>  <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/hole_command.html#hole_command">hole_command</a></div>
<div class="indent"><p></p>
       </div>
</div></body></html>