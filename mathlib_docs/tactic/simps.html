<html><head><title>tactic.simps</title><link rel="stylesheet" href="https://robertylewis.com/mathlib_docs/style.css"></head><body><div class="mod_doc"><p># simps attribute
  This file defines the <code>@[simps]</code> attribute, to automatically generate simp-lemmas
  reducing a definition when projections are applied to it.</p>

<p>## Tags
  structures, projections, simp, simplifier, generates declarations</p>
</div><div class="entry"><a id="simps_add_projection">      <h4>simps_add_projection</h4><code><a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></code>
<div class="indent"><p><p>Add a lemma with <code>nm</code> stating that <code>lhs = rhs</code>. <code>type</code> is the type of both <code>lhs</code> and <code>rhs</code>,
 <code>args</code> is the list of local constants occurring, and <code>univs</code> is the list of universe variables.
 If <code>add_simp</code> then we make the resulting lemma a simp-lemma.</p>
</p>       </div>
</div><div class="entry"><a id="simps_add_projections">      <h4>simps_add_projections</h4><code><a href="https://robertylewis.com/mathlib_docs/core/init/meta/environment.html#environment">environment</a> →
<a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a> →
<a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/expr.html#expr">expr</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></code>
<div class="indent"><p><p>Derive lemmas specifying the projections of the declaration.
 If <code>todo</code> is non-empty, it will generate exactly the names in <code>todo</code>.</p>
</p>       </div>
</div><div class="entry"><a id="simps_tac">      <h4>simps_tac</h4><code><a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> bool.ff → <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#opt_param">opt_param</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a>) list.nil → <a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></code>
<div class="indent"><p><p><code>simps_tac</code> derives simp-lemmas for all (nested) non-Prop projections of the declaration.
 If <code>todo</code> is non-empty, it will generate exactly the names in <code>todo</code>.
 If <code>short_nm</code> is true, the generated names will only use the last projection name.</p>
</p>       </div>
</div><div class="entry"><a id="simps_parser">      <h4>simps_parser</h4><code><a href="https://robertylewis.com/mathlib_docs/core/init/meta/lean/parser.html#lean.parser">lean.parser</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> × <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> × <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a>)</code>
<div class="indent"><p><p>The parser for simps. Pattern: <code>'lemmas_only'? ident*</code></p>
</p>       </div>
</div><div class="entry"><a id="simps_attr">      <h4>simps_attr</h4><code><a href="https://robertylewis.com/mathlib_docs/core/init/meta/attribute.html#user_attribute">user_attribute</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> × <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#bool">bool</a> × <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#list">list</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a>)</code>
<div class="indent"><p><ul>
<li>Automatically derive lemmas specifying the projections of this declaration.</li>
<li>Example: (note that the forward and reverse functions are specified differently!)
<code>lean
@[simps] def refl (α) : α ≃ α := ⟨id, λ x, x, λ x, rfl, λ x, rfl⟩
</code>
derives two simp-lemmas:
<code>lean
@[simp] lemma refl_to_fun (α) (x : α) : (refl α).to_fun x = id x
@[simp] lemma refl_inv_fun (α) (x : α) : (refl α).inv_fun x = x
</code></li>
<li>It does not derive simp-lemmas for the prop-valued projections.</li>
<li>It will automatically reduce newly created beta-redexes, but not unfold any definitions.</li>
<li>If one of the fields itself is a structure, this command will recursively create
simp-lemmas for all fields in that structure.</li>
<li>You can use <code>@[simps proj1 proj2 ...]</code> to only generate the projection lemmas for the specified
projections. For example:
<code>lean
attribute [simps to_fun] refl
</code></li>
<li>If one of the values is an eta-expanded structure, we will eta-reduce this structure.</li>
<li>You can use <code>@[simps lemmas_only]</code> to derive the lemmas, but not mark them
as simp-lemmas.</li>
<li>You can use <code>@[simps short_name]</code> to only use the name of the last projection for the name of the
generated lemmas.</li>
<li>The precise syntax is <code>('simps' 'lemmas_only'? 'short_name'? ident*)</code>.</li>
<li>If one of the projections is marked as a coercion, the generated lemmas do <em>not</em> use this
coercion.</li>
<li><code>@[simps]</code> reduces let-expressions where necessary.</li>
<li>If one of the fields is a partially applied constructor, we will eta-expand it
(this likely never happens).</li>
</ul>
</p>       </div>
</div></body></html>