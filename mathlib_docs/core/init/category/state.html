<!DOCTYPE html><html lang="en"><head><title>core.init.category.state</title><meta charset="UTF-8"><link rel="stylesheet" href="/home/rob/lean/mathlib/scripts/html_out/style.css"></head><body><div class="mod_doc"><p></p>
</div><div class="cnst"><a id="state_t"></a>      <h4>state_t</h4><code>Type u → (Type u → Type v) → Type u → Type (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/algebra/functions.html#max">max</a> u v)</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state"></a>      <h4>state</h4><code>Type u → Type u → Type u</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.pure"></a>      <h4>state_t.pure</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] {α : Type u}, α → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.bind"></a>      <h4>state_t.bind</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] {α β : Type u},
  <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α → (α → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m β) → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m β</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.monad"></a>      <h4>state_t.monad</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m], <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m)</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.orelse"></a>      <h4>state_t.orelse</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/alternative.html#alternative">alternative</a> m] {α : Type u},
  <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.failure"></a>      <h4>state_t.failure</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/alternative.html#alternative">alternative</a> m] {α : Type u}, <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.alternative"></a>      <h4>state_t.alternative</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/alternative.html#alternative">alternative</a> m], <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/alternative.html#alternative">alternative</a> (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m)</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.get"></a>      <h4>state_t.get</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m], <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m σ</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.put"></a>      <h4>state_t.put</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m], σ → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#punit">punit</a></code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.modify"></a>      <h4>state_t.modify</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m], (σ → σ) → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#punit">punit</a></code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.lift"></a>      <h4>state_t.lift</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] {α : Type u}, m α → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.has_monad_lift"></a>      <h4>state_t.has_monad_lift</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m], <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/lift.html#has_monad_lift">has_monad_lift</a> m (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m)</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_map"></a>      <h4>state_t.monad_map</h4><code>Π {σ : Type u_1} {m : Type u_1 → Type u_2} {m' : Type u_1 → Type u_3} [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_3 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m']
{α : Type u_1}, (Π {α : Type u_1}, m α → m' α) → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m' α</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.monad_functor"></a>      <h4>state_t.monad_functor</h4><code>Π (σ : Type u_1) (m m' : Type u_1 → Type u_2) [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_3 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m'],
  <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/lift.html#monad_functor">monad_functor</a> m m' (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m) (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m')</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.adapt"></a>      <h4>state_t.adapt</h4><code>Π {σ σ' σ'' α : Type u} {m : Type u → Type v} [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m],
  (σ → σ' × σ'') → (σ' → σ'' → σ) → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ' m α → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m α</code>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.monad_except"></a>      <h4>state_t.monad_except</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] (ε : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#out_param">out_param</a> (Type u_1)) [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/except.html#monad_except">monad_except</a> ε m],
  <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/except.html#monad_except">monad_except</a> ε (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m)</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="cnst"><a id="monad_state"></a>      <h4>monad_state</h4><code><a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#out_param">out_param</a> (Type u) → (Type u → Type v) → Type (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/algebra/functions.html#max">max</a> (u+1) v)</code>
<div class="indent"><p>An implementation of <a href="https://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-State-Class.html">MonadState</a>.
   In contrast to the Haskell implementation, we use overlapping instances to derive instances
   automatically from <code>monad_lift</code>.</p>

<p>Note: This class can be seen as a simplification of the more "principled" definition
   <code>lean
   class monad_state_lift (σ : out_param (Type u)) (n : Type u → Type u) :=
   (lift {} {α : Type u} : (∀ {m : Type u → Type u} [monad m], state_t σ m α) → n α)
</code>
   which better describes the intent of "we can lift a <code>state_t</code> from anywhere in the monad stack".
   However, by parametricity the types <code>∀ m [monad m], σ → m (α × σ)</code> and <code>σ → α × σ</code> should be
   equivalent because the only way to obtain an <code>m</code> is through <code>pure</code>.</p>
       </div>
</div><div class="def"><a id="monad_state_trans"></a>      <h4>monad_state_trans</h4><code>Π {σ : Type u} {m : Type u → Type v} {n : Type u → Type w} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/lift.html#has_monad_lift">has_monad_lift</a> m n]
[_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state">monad_state</a> σ m], <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state">monad_state</a> σ n</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_state"></a>      <h4>state_t.monad_state</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m], <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state">monad_state</a> σ (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m)</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="get"></a>      <h4>get</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state">monad_state</a> σ m], m σ</code>
<div class="indent"><p>Obtain the top-most state of a monad stack.</p>
       </div>
</div><div class="def"><a id="put"></a>      <h4>put</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state">monad_state</a> σ m], σ → m <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#punit">punit</a></code>
<div class="indent"><p>Set the top-most state of a monad stack.</p>
       </div>
</div><div class="def"><a id="modify"></a>      <h4>modify</h4><code>Π {σ : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m] [_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state">monad_state</a> σ m], (σ → σ) → m <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#punit">punit</a></code>
<div class="indent"><p>Map the top-most state of a monad stack.</p>

<p>Note: <code>modify f</code> may be preferable to <code>f &lt;$&gt; get &gt;&gt;= put</code> because the latter
   does not use the state linearly (without sufficient inlining).</p>
       </div>
</div><div class="cnst"><a id="monad_state_adapter"></a>      <h4>monad_state_adapter</h4><code><a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#out_param">out_param</a> (Type u) → <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#out_param">out_param</a> (Type u) → (Type u → Type v) → (Type u → Type v) → Type (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/algebra/functions.html#max">max</a> (u+1) v)</code>
<div class="indent"><p>Adapt a monad stack, changing the type of its top-most state.</p>

<p>This class is comparable to <a href="https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Zoom.html#t:Zoom">Control.Lens.Zoom</a>, but does not use lenses (yet?), and is derived automatically for any transformer implementing <code>monad_functor</code>.</p>

<p>For zooming into a part of the state, the <code>split</code> function should split σ into the part σ' and the "context" σ'' so that the potentially modified σ' and the context can be rejoined by <code>join</code> in the end.
   In the simplest case, the context can be chosen as the full outer state (ie. <code>σ'' = σ</code>), which makes <code>split</code> and <code>join</code> simpler to define. However, note that the state will not be used linearly in this case.</p>

<p>Example:
   <code>lean
   def zoom_fst {α σ σ' : Type} : state σ α → state (σ × σ') α :=
   adapt_state id prod.mk
</code></p>

<p>The function can also zoom out into a "larger" state, where the new parts are supplied by <code>split</code> and discarded by <code>join</code> in the end. The state is therefore not used linearly anymore but merely affinely, which is not a practically relevant distinction in Lean.</p>

<p>Example:
   <code>lean
   def with_snd {α σ σ' : Type} (snd : σ') : state (σ × σ') α → state σ α :=
   adapt_state (λ st, ((st, snd), ())) (λ ⟨st,snd⟩ _, st)
</code></p>

<p>Note: This class can be seen as a simplification of the more "principled" definition
   <code>lean
   class monad_state_functor (σ σ' : out_param (Type u)) (n n' : Type u → Type u) :=
   (map {} {α : Type u} : (∀ {m : Type u → Type u} [monad m], state_t σ m α → state_t σ' m α) → n α → n' α)
</code>
   which better describes the intent of "we can map a <code>state_t</code> anywhere in the monad stack".
   If we look at the unfolded type of the first argument <code>∀ m [monad m], (σ → m (α × σ)) → σ' → m (α × σ')</code>, we see that it has the lens type <code>∀ f [functor f], (α → f α) → β → f β</code> with <code>f</code> specialized to <code>λ σ, m (α × σ)</code> (exercise: show that this is a lawful functor). We can build all lenses we are insterested in from the functions <code>split</code> and <code>join</code> as
   <code>lean
   λ f _ st, let (st, ctx) := split st in
             (λ st', join st' ctx) &lt;$&gt; f st
</code></p>
       </div>
</div><div class="def"><a id="monad_state_adapter_trans"></a>      <h4>monad_state_adapter_trans</h4><code>Π {σ σ' : Type u} {m m' n n' : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/lift.html#monad_functor">monad_functor</a> m m' n n']
[_inst_2 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state_adapter">monad_state_adapter</a> σ σ' m m'], <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state_adapter">monad_state_adapter</a> σ σ' n n'</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_state_adapter"></a>      <h4>state_t.monad_state_adapter</h4><code>Π {σ σ' : Type u} {m : Type u → Type v} [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/monad.html#monad">monad</a> m],
  <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#monad_state_adapter">monad_state_adapter</a> σ σ' (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m) (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ' m)</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_run"></a>      <h4>state_t.monad_run</h4><code>Π (σ : Type u_1) (m : Type u_1 → Type u_2) (out : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/core.html#out_param">out_param</a> (Type u_1 → Type u_2)) [_inst_1 : <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/lift.html#monad_run">monad_run</a> out m],
  <a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/lift.html#monad_run">monad_run</a> (λ (α : Type u_1), σ → out (α × σ)) (<a href="/home/rob/lean/mathlib/scripts/html_out/core/init/category/state.html#state_t">state_t</a> σ m)</code>
<div class="indent"><p></p>
       Attributes: instance</div>
</div></body></html>