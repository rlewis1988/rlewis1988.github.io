<!DOCTYPE html><html lang="en"><head><title>core.init.category.state</title><meta charset="UTF-8"><link rel="stylesheet" href="https://robertylewis.com/mathlib_docs/style.css"></head><body><div class="mod_doc"><p></p>
</div><div class="cnst"><a id="state_t"></a>      <span class="decl_name">state_t</span> <span class="decl_args">(σ : Type u)</span> <span class="decl_args">(m : Type u → Type v)</span> <span class="decl_args">(α : Type u)</span> <span class="decl_args">:</span>       <div class="decl_type">Type (<a href="https://robertylewis.com/mathlib_docs/core/init/algebra/functions.html#max">max</a> u v)</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state"></a>      <span class="decl_name">state</span> <span class="decl_args">(σ α : Type u)</span> <span class="decl_args">:</span>       <div class="decl_type">Type u</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.pure"></a>      <span class="decl_name">state_t.pure</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">{α : Type u}</span> <span class="decl_args">(a : α)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.bind"></a>      <span class="decl_name">state_t.bind</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">{α β : Type u}</span> <span class="decl_args">(x : <a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α)</span> <span class="decl_args">(f : α → <a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m β)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m β</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.monad"></a>      <span class="decl_name">state_t.monad</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m)</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.orelse"></a>      <span class="decl_name">state_t.orelse</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/alternative.html#alternative">alternative</a> m]</span> <span class="decl_args">{α : Type u}</span> <span class="decl_args">(x₁ x₂ : <a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.failure"></a>      <span class="decl_name">state_t.failure</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/alternative.html#alternative">alternative</a> m]</span> <span class="decl_args">{α : Type u}</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.alternative"></a>      <span class="decl_name">state_t.alternative</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/alternative.html#alternative">alternative</a> m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/alternative.html#alternative">alternative</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m)</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.get"></a>      <span class="decl_name">state_t.get</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m σ</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.put"></a>      <span class="decl_name">state_t.put</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">(a : σ)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#punit">punit</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.modify"></a>      <span class="decl_name">state_t.modify</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">(f : σ → σ)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#punit">punit</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.lift"></a>      <span class="decl_name">state_t.lift</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">{α : Type u}</span> <span class="decl_args">(t : m α)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.has_monad_lift"></a>      <span class="decl_name">state_t.has_monad_lift</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/lift.html#has_monad_lift">has_monad_lift</a> m (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m)</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_map"></a>      <span class="decl_name">state_t.monad_map</span> <span class="decl_args">{σ : Type u_1}</span> <span class="decl_args">{m : Type u_1 → Type u_2}</span> <span class="decl_args">{m' : Type u_1 → Type u_3}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m']</span> <span class="decl_args">{α : Type u_1}</span> <span class="decl_args">(f : Π {α : Type u_1}, m α → m' α)</span> <span class="decl_args">(a : <a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m' α</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.monad_functor"></a>      <span class="decl_name">state_t.monad_functor</span> <span class="decl_args">(σ : Type u_1)</span> <span class="decl_args">(m m' : Type u_1 → Type u_2)</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m']</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/lift.html#monad_functor">monad_functor</a> m m' (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m) (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m')</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.adapt"></a>      <span class="decl_name">state_t.adapt</span> <span class="decl_args">{σ σ' σ'' α : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">(split : σ → σ' × σ'')</span> <span class="decl_args">(join : σ' → σ'' → σ)</span> <span class="decl_args">(x : <a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ' m α)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m α</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="state_t.monad_except"></a>      <span class="decl_name">state_t.monad_except</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">(ε : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#out_param">out_param</a> (Type u_1))</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/except.html#monad_except">monad_except</a> ε m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/except.html#monad_except">monad_except</a> ε (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m)</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="cnst"><a id="monad_state"></a>      <span class="decl_name">monad_state</span> <span class="decl_args">(σ : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#out_param">out_param</a> (Type u))</span> <span class="decl_args">(m : Type u → Type v)</span> <span class="decl_args">:</span>       <div class="decl_type">Type (<a href="https://robertylewis.com/mathlib_docs/core/init/algebra/functions.html#max">max</a> (u+1) v)</div>
<div class="indent"><p>An implementation of <a href="https://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-State-Class.html">MonadState</a>.
   In contrast to the Haskell implementation, we use overlapping instances to derive instances
   automatically from <code>monad_lift</code>.</p>

<p>Note: This class can be seen as a simplification of the more "principled" definition
   <code>lean
   class monad_state_lift (σ : out_param (Type u)) (n : Type u → Type u) :=
   (lift {} {α : Type u} : (∀ {m : Type u → Type u} [monad m], state_t σ m α) → n α)
</code>
   which better describes the intent of "we can lift a <code>state_t</code> from anywhere in the monad stack".
   However, by parametricity the types <code>∀ m [monad m], σ → m (α × σ)</code> and <code>σ → α × σ</code> should be
   equivalent because the only way to obtain an <code>m</code> is through <code>pure</code>.</p>
       </div>
</div><div class="def"><a id="monad_state_trans"></a>      <span class="decl_name">monad_state_trans</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">{n : Type u → Type w}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/lift.html#has_monad_lift">has_monad_lift</a> m n]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state">monad_state</a> σ m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state">monad_state</a> σ n</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_state"></a>      <span class="decl_name">state_t.monad_state</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state">monad_state</a> σ (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m)</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="get"></a>      <span class="decl_name">get</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state">monad_state</a> σ m]</span> <span class="decl_args">:</span>       <div class="decl_type">m σ</div>
<div class="indent"><p>Obtain the top-most state of a monad stack.</p>
       </div>
</div><div class="def"><a id="put"></a>      <span class="decl_name">put</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state">monad_state</a> σ m]</span> <span class="decl_args">(st : σ)</span> <span class="decl_args">:</span>       <div class="decl_type">m <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#punit">punit</a></div>
<div class="indent"><p>Set the top-most state of a monad stack.</p>
       </div>
</div><div class="def"><a id="modify"></a>      <span class="decl_name">modify</span> <span class="decl_args">{σ : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state">monad_state</a> σ m]</span> <span class="decl_args">(f : σ → σ)</span> <span class="decl_args">:</span>       <div class="decl_type">m <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#punit">punit</a></div>
<div class="indent"><p>Map the top-most state of a monad stack.</p>

<p>Note: <code>modify f</code> may be preferable to <code>f &lt;$&gt; get &gt;&gt;= put</code> because the latter
   does not use the state linearly (without sufficient inlining).</p>
       </div>
</div><div class="cnst"><a id="monad_state_adapter"></a>      <span class="decl_name">monad_state_adapter</span> <span class="decl_args">(σ σ' : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#out_param">out_param</a> (Type u))</span> <span class="decl_args">(m m' : Type u → Type v)</span> <span class="decl_args">:</span>       <div class="decl_type">Type (<a href="https://robertylewis.com/mathlib_docs/core/init/algebra/functions.html#max">max</a> (u+1) v)</div>
<div class="indent"><p>Adapt a monad stack, changing the type of its top-most state.</p>

<p>This class is comparable to <a href="https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Zoom.html#t:Zoom">Control.Lens.Zoom</a>, but does not use lenses (yet?), and is derived automatically for any transformer implementing <code>monad_functor</code>.</p>

<p>For zooming into a part of the state, the <code>split</code> function should split σ into the part σ' and the "context" σ'' so that the potentially modified σ' and the context can be rejoined by <code>join</code> in the end.
   In the simplest case, the context can be chosen as the full outer state (ie. <code>σ'' = σ</code>), which makes <code>split</code> and <code>join</code> simpler to define. However, note that the state will not be used linearly in this case.</p>

<p>Example:
   <code>lean
   def zoom_fst {α σ σ' : Type} : state σ α → state (σ × σ') α :=
   adapt_state id prod.mk
</code></p>

<p>The function can also zoom out into a "larger" state, where the new parts are supplied by <code>split</code> and discarded by <code>join</code> in the end. The state is therefore not used linearly anymore but merely affinely, which is not a practically relevant distinction in Lean.</p>

<p>Example:
   <code>lean
   def with_snd {α σ σ' : Type} (snd : σ') : state (σ × σ') α → state σ α :=
   adapt_state (λ st, ((st, snd), ())) (λ ⟨st,snd⟩ _, st)
</code></p>

<p>Note: This class can be seen as a simplification of the more "principled" definition
   <code>lean
   class monad_state_functor (σ σ' : out_param (Type u)) (n n' : Type u → Type u) :=
   (map {} {α : Type u} : (∀ {m : Type u → Type u} [monad m], state_t σ m α → state_t σ' m α) → n α → n' α)
</code>
   which better describes the intent of "we can map a <code>state_t</code> anywhere in the monad stack".
   If we look at the unfolded type of the first argument <code>∀ m [monad m], (σ → m (α × σ)) → σ' → m (α × σ')</code>, we see that it has the lens type <code>∀ f [functor f], (α → f α) → β → f β</code> with <code>f</code> specialized to <code>λ σ, m (α × σ)</code> (exercise: show that this is a lawful functor). We can build all lenses we are insterested in from the functions <code>split</code> and <code>join</code> as
   <code>lean
   λ f _ st, let (st, ctx) := split st in
             (λ st', join st' ctx) &lt;$&gt; f st
</code></p>
       </div>
</div><div class="def"><a id="monad_state_adapter_trans"></a>      <span class="decl_name">monad_state_adapter_trans</span> <span class="decl_args">{σ σ' : Type u}</span> <span class="decl_args">{m m' n n' : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/lift.html#monad_functor">monad_functor</a> m m' n n']</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state_adapter">monad_state_adapter</a> σ σ' m m']</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state_adapter">monad_state_adapter</a> σ σ' n n'</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_state_adapter"></a>      <span class="decl_name">state_t.monad_state_adapter</span> <span class="decl_args">{σ σ' : Type u}</span> <span class="decl_args">{m : Type u → Type v}</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/monad.html#monad">monad</a> m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#monad_state_adapter">monad_state_adapter</a> σ σ' (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m) (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ' m)</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="state_t.monad_run"></a>      <span class="decl_name">state_t.monad_run</span> <span class="decl_args">(σ : Type u_1)</span> <span class="decl_args">(m : Type u_1 → Type u_2)</span> <span class="decl_args">(out : <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#out_param">out_param</a> (Type u_1 → Type u_2))</span> <span class="decl_args">[<a href="https://robertylewis.com/mathlib_docs/core/init/category/lift.html#monad_run">monad_run</a> out m]</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/category/lift.html#monad_run">monad_run</a> (λ (α : Type u_1), σ → out (α × σ)) (<a href="https://robertylewis.com/mathlib_docs/core/init/category/state.html#state_t">state_t</a> σ m)</div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div></body></html>