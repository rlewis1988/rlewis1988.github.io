<!DOCTYPE html><html lang="en"><head><title>algebra.group.to_additive</title><meta charset="UTF-8"><link rel="stylesheet" href="https://robertylewis.com/mathlib_docs/style.css"></head><body><div class="nav"><a href="https://robertylewis.com/mathlib_docs//index.html">root</a>/<a href="https://robertylewis.com/mathlib_docs/algebra/index.html">algebra</a>/<a href="https://robertylewis.com/mathlib_docs/algebra/group/index.html">group</a>/<a href="to_additive.html">to_additive</a></div><div class="mod_doc"><h1>Transport multiplicative to additive</h1>

<p>This file defines an attribute <code>to_additive</code> that can be used to
automatically transport theorems and definitions (but not inductive
types and structures) from multiplicative theory to additive theory.</p>

<p>To use this attribute, just write</p>

<p><code>
@[to_additive]
theorem mul_comm' {α} [<a href="https://robertylewis.com/mathlib_docs/core/init/algebra/group.html#comm_semigroup">comm_semigroup</a> α] (x y : α) : x * y = y * x := comm_semigroup.mul_comm
</code></p>

<p>This code will generate a theorem named <code>add_comm'</code>.  It is also
possible to manually specify the name of the new declaration, and
provide a documentation string.</p>

<p>The transport tries to do the right thing in most cases using several
heuristics described below.  However, in some cases it fails, and
requires manual intervention.</p>

<h2>Implementation notes</h2>

<h3>Handling of hidden definitions</h3>

<p>Before transporting the “main” declaration <code>src</code>, <code>to_additive</code> first
scans its type and value for names starting with <code>src</code>, and transports
them. This includes auxiliary definitions like <code>src._match_1</code>,
<code>src._proof_1</code>.</p>

<p>After transporting the “main” declaration, <code>to_additive</code> transports
its equational lemmas.</p>

<h3>Structure fields and constructors</h3>

<p>If <code>src</code> is a structure, then <code>to_additive</code> automatically adds
structure fields to its mapping, and similarly for constructors of
inductive types.</p>

<p>For new structures this means that <code>to_additive</code> automatically handles
coercions, and for old structures it does the same, if ancestry
information is present in <code>@[ancestor]</code> attributes.</p>

<h3>Name generation</h3>

<ul>
<li><p>If <code>@[to_additive]</code> is called without a <code>name</code> argument, then the
new name is autogenerated.  First, it takes the longest prefix of
the source name that is already known to <code>to_additive</code>, and replaces
this prefix with its additive counterpart. Second, it takes the last
part of the name (i.e., after the last dot), and replaces common
name parts (“mul”, “one”, “inv”, “prod”) with their additive versions.</p></li>
<li><p>If <code>@[to_additive]</code> is called with a <code>name</code> argument <code>new_name</code>
/without a dot/, then <code>to_additive</code> updates the prefix as described
above, then replaces the last part of the name with <code>new_name</code>.</p></li>
<li><p>If <code>@[to_additive]</code> is called with a <code>name</code> argument
<code>new_namespace.new_name</code> /with a dot/, then <code>to_additive</code> uses this
new name as is.</p></li>
</ul>

<p>As a safety check, in the first two cases <code>to_additive</code> double checks
that the new name differs from the original one.</p>

<h3>Missing features</h3>

<ul>
<li><p>Automatically transport structures and other inductive types.</p></li>
<li><p>Handle <code>protected</code> attribute. Currently all new definitions are public.</p></li>
<li><p>For structures, automatically generate theorems like <code>group α ↔
<a href="https://robertylewis.com/mathlib_docs/core/init/algebra/group.html#add_group">add_group</a> (<a href="https://robertylewis.com/mathlib_docs/algebra/group/type_tags.html#additive">additive</a> α)</code>.</p></li>
<li><p>Mapping of prefixes that do not correspond to any definition, see
<code>quotient_group</code>.</p></li>
<li><p>Rewrite rules for the last part of the name that work in more
cases. E.g., we can replace <code>monoid</code> with <code>add_monoid</code> etc.</p></li>
</ul>
</div><div class="def"><a id="to_additive.aux_attr"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L92">to_additive.aux_attr</a></span>  <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/attribute.html#user_attribute">user_attribute</a> (<a href="https://robertylewis.com/mathlib_docs/core/init/meta/rb_map.html#name_map">name_map</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>) <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="to_additive.map_namespace"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L106">to_additive.map_namespace</a></span> <span class="decl_args">(src tgt : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="cnst"><a id="to_additive.value_type"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L113">to_additive.value_type</a></span>  <span class="decl_args">:</span>       <div class="decl_type">Type</div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="to_additive.value_type.has_reflect"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L113">to_additive.value_type.has_reflect</a></span>  <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/has_reflect.html#has_reflect">has_reflect</a> <a href="https://robertylewis.com/mathlib_docs/algebra/group/to_additive.html#to_additive.value_type">to_additive.value_type</a></div>
<div class="indent"><p></p>
       Attributes: instance</div>
</div><div class="def"><a id="to_additive.tokens_dict"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L115">to_additive.tokens_dict</a></span>  <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/rb_map.html#native.rb_map">native.rb_map</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a> <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="to_additive.guess_name"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L119">to_additive.guess_name</a></span> <span class="decl_args">(a : <a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/data/string/basic.html#string">string</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="to_additive.target_name"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L124">to_additive.target_name</a></span> <span class="decl_args">(src tgt : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">(dict : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/rb_map.html#name_map">name_map</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="to_additive.parser"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L142">to_additive.parser</a></span>  <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/lean/parser.html#lean.parser">lean.parser</a> <a href="https://robertylewis.com/mathlib_docs/algebra/group/to_additive.html#to_additive.value_type">to_additive.value_type</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="to_additive.proceed_fields"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L163">to_additive.proceed_fields</a></span> <span class="decl_args">(env : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/environment.html#environment">environment</a>)</span> <span class="decl_args">(src tgt : <a href="https://robertylewis.com/mathlib_docs/core/init/meta/name.html#name">name</a>)</span> <span class="decl_args">(prio : ℕ)</span> <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/tactic.html#tactic">tactic</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a></div>
<div class="indent"><p></p>
       </div>
</div><div class="def"><a id="to_additive.attr"></a>      <span class="decl_name"><a href="https://github.com/leanprover-community/mathlib/blob/886b15b5ea473ae51ed90de31b05f23de00be10d/src/algebra/group/to_additive.lean#L178">to_additive.attr</a></span>  <span class="decl_args">:</span>       <div class="decl_type"><a href="https://robertylewis.com/mathlib_docs/core/init/meta/attribute.html#user_attribute">user_attribute</a> <a href="https://robertylewis.com/mathlib_docs/core/init/core.html#unit">unit</a> <a href="https://robertylewis.com/mathlib_docs/algebra/group/to_additive.html#to_additive.value_type">to_additive.value_type</a></div>
<div class="indent"><p></p>
       </div>
</div></body></html>